################################################################################
#  HTTP → qr.girumed.ru:8081
#  (plain-text, редиректим в HTTPS-порт)
################################################################################
qr.girumed.ru:8081 {
    # НЕ участвуем в TLS-автоматизации
    tls off

    # Редиректим всё на HTTPS-порт, сохраняя путь и query
    redir https://qr.girumed.ru:8443{uri}
}

################################################################################
#  HTTPS → qr.girumed.ru:8443
#  (проксируем в qrbot:8080, TLS = internal)
################################################################################
qr.girumed.ru:8443 {
    # единственный TLS-блок — internal-сертификат
    tls internal

    # health-check
    @health path /health
    respond @health 200

    # сжатие
    encode zstd gzip

    # прокси на бэкенд
    reverse_proxy qrbot:8080
}