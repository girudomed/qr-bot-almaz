# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Å–ø–∞–º–∞ —Ç–∞–º–∞–≥–æ—á–∏

## üö® –°–†–û–ß–ù–û: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–ø–∞–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ SQL Editor
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞ `create_notifications_table.sql`:

```sql
CREATE TABLE IF NOT EXISTS tamagotchi_notifications (
    id BIGSERIAL PRIMARY KEY,
    telegram_id BIGINT NOT NULL,
    notification_type VARCHAR(20) NOT NULL CHECK (notification_type IN ('critical', 'hungry', 'death')),
    sent_at TIMESTAMP WITHOUT TIME ZONE NOT NULL DEFAULT NOW(),
    created_at TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW()
);

CREATE INDEX IF NOT EXISTS idx_tamagotchi_notifications_telegram_id 
ON tamagotchi_notifications(telegram_id);

CREATE INDEX IF NOT EXISTS idx_tamagotchi_notifications_type_time 
ON tamagotchi_notifications(telegram_id, notification_type, sent_at DESC);
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

```bash
# –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd ~/qr-bot-almaz

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ç–∞–º–∞–≥–æ—á–∏
docker compose restart tamagotchi_scheduler

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker compose ps tamagotchi_scheduler
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker compose logs -f tamagotchi_scheduler

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 50 –∑–∞–ø–∏—Å–µ–π
docker compose logs --tail=50 tamagotchi_scheduler
```

### –®–∞–≥ 4: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã (9:00-18:00 –ú–°–ö)
- –°–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–ø–∞ "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏" –≤ –ª–æ–≥–∞—Ö
- –ú–µ–Ω—å—à–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ —Ü–µ–ª–æ–º

‚ùå **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —Å–æ–∑–¥–∞–ª–∞—Å—å –ª–∏ —Ç–∞–±–ª–∏—Ü–∞ `tamagotchi_notifications`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª—Å—è —Å –Ω–æ–≤—ã–º –∫–æ–¥–æ–º

### –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
# –ü–æ–ª–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
docker compose stop tamagotchi_scheduler

# –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞—Ç–Ω–æ
docker compose start tamagotchi_scheduler
```

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –í Supabase (SQL Editor):

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
SELECT * FROM tamagotchi_notifications ORDER BY sent_at DESC LIMIT 10;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
SELECT 
    notification_type,
    COUNT(*) as count,
    MIN(sent_at) as first_sent,
    MAX(sent_at) as last_sent
FROM tamagotchi_notifications 
WHERE DATE(sent_at) = CURRENT_DATE
GROUP BY notification_type;
```

### –í –ª–æ–≥–∞—Ö Docker:

–ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏:
- `"–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ–ª–æ–¥–Ω—ã—Ö —Ç–∞–º–∞–≥–æ—á–∏..."`
- `"–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–º–∞–≥–æ—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"`
- `"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ... —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"`

---

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:
- **–ù–æ—á–Ω–æ–π —Å–ø–∞–º –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—Å—è** (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ 9:00-18:00 –ú–°–ö)
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –º–∞–∫—Å–∏–º—É–º —Ä–∞–∑ –≤ 4 —á–∞—Å–∞
- **–û–±—ã—á–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –º–∞–∫—Å–∏–º—É–º —Ä–∞–∑ –≤ 6 —á–∞—Å–æ–≤
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–º–µ—Ä—Ç–∏** - –º–∞–∫—Å–∏–º—É–º —Ä–∞–∑ –≤ –¥–µ–Ω—å

---

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

1. **–û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
   ```bash
   git checkout HEAD~1 schedulers/tamagotchi_scheduler.py
   docker compose restart tamagotchi_scheduler
   ```

2. **–°–≤—è–∑–∞—Ç—å—Å—è —Å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º**

3. **–í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫:**
   ```bash
   docker compose stop tamagotchi_scheduler
   ```

---

**–í—Ä–µ–º—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:** ~5 –º–∏–Ω—É—Ç  
**–ü—Ä–æ—Å—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞)  
**–†–∏—Å–∫–∏:** –ù–∏–∑–∫–∏–µ (–∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ –ª–æ–≥–∏–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
